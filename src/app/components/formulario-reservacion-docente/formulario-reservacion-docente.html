<div class="contenedor-formulario">
  <!-- PANTALLA DE CONFIRMACIÓN EXITOSA -->
  <div *ngIf="reservacionConfirmada" class="confirmacion-exitosa">
    <div class="icono-exito">
      <i class="fas fa-check-circle"></i>
    </div>
    <h2 class="titulo-confirmacion">¡Reservación Confirmada!</h2>
    <p class="mensaje-confirmacion">Tu reserva se ha completado satisfactoriamente</p>
    
    <div class="imagen-check">
      <i class="fas fa-check-double"></i>
    </div>
    
    <!-- CONTENEDOR DEL QR SIMPLIFICADO -->
    <div class="qr-container-simple" *ngIf="qrGenerado">
      <!-- Estado de carga -->
      <div *ngIf="generandoQR && !qrCargado" class="qr-cargando">
        <div class="spinner"></div>
        <p>Generando código QR...</p>
      </div>

      <!-- QR Generado Simple -->
      <div *ngIf="!generandoQR && qrDataUrl" class="qr-simple">
        <img [src]="qrDataUrl" 
             alt="Código QR de reservación docente" 
             class="qr-image-simple"
             (load)="onQRLoaded()"
             (error)="onQRError()">
      </div>

      <!-- Botón para regenerar -->
      <button class="btn-regenerar-qr" (click)="regenerarQR()" *ngIf="errorQR || !qrCargado">
        <i class="fas fa-sync-alt"></i> Reintentar QR
      </button>
    </div>
  </div>

  <!-- FORMULARIO PRINCIPAL -->
  <div *ngIf="!resumen && !reservacionConfirmada">
    <h2 class="titulo-form">
      <i class="fas fa-calendar-check"></i>
      Formulario de Reservación Docente
    </h2>

    <form class="form-grid">
      <!-- NOMBRE COMPLETO -->
      <div class="form-group">
        <label><i class="fas fa-user icono azul"></i> Nombre completo</label>
        <input type="text" [(ngModel)]="nombre" name="nombre" placeholder="Ingrese su nombre completo" required>
      </div>

      <!-- NÚMERO DE EMPLEADO -->
      <div class="form-group">
        <label><i class="fas fa-id-card icono rojo"></i> Número de Empleado</label>
        <input type="text" [(ngModel)]="numeroempleado" name="numeroempleado" 
               placeholder="Número de empleado" required>
      </div>

      <!-- CORREO EDUCATIVO -->
      <div class="form-group">
        <label><i class="fas fa-envelope icono azul"></i> Correo educativo</label>
        <input type="email" [(ngModel)]="correo" name="correo" placeholder="ejemplo@ceutec.edu" required>
      </div>

      <!-- CLASE -->
      <div class="form-group">
        <label><i class="fas fa-graduation-cap icono beige"></i> Clase</label>
        <input type="text" [(ngModel)]="clase" name="clase" placeholder="Nombre de la clase" required>
      </div>

      <!-- SECCIÓN -->
      <div class="form-group">
        <label><i class="fas fa-graduation-cap icono azul"></i> Sección</label>
        <input type="text" [(ngModel)]="seccion" name="seccion" placeholder="Sección" required>
      </div>

      <!-- CAMPUS -->
      <div class="form-group">
        <label><i class="fas fa-university icono azul"></i> Campus</label>
        <select [(ngModel)]="campus" name="campus" (change)="cargarHorasOcupadas()">
          <option value="">Seleccione un campus</option>
          <option *ngFor="let c of campusOpciones" [value]="c">{{ c }}</option>
        </select>
      </div>

      <!-- SEDE -->
      <div class="form-group">
        <label><i class="fas fa-map-marker-alt icono rojo"></i> Sede</label>
        <input type="text" [(ngModel)]="sede" name="sede" placeholder="Sede de la reservación">
      </div>

      <!-- TIPO DE AULA -->
      <div class="form-group">
        <label><i class="fas fa-chalkboard icono beige"></i> Tipo de aula</label>
        <select [(ngModel)]="tipoaula" name="tipoaula" (change)="cargarHorasOcupadas()">
          <option value="">Seleccione tipo de aula</option>
          <option value="Salón de estudio">Salón de estudio</option>
          <option value="Laboratorio">Laboratorio</option>
          <option value="Aula para eventos">Aula para eventos</option>
          <option value="Aula normal">Aula normal</option>
        </select>
      </div>

      <!-- NÚMERO DE AULA -->
      <div class="form-group">
        <label><i class="fas fa-door-open icono beige"></i> Número de Aula</label>
        <input type="text" [(ngModel)]="numeroaula" name="numeroaula" placeholder="Número de Aula" 
               (change)="cargarHorasOcupadas()" required>
      </div>

      <!-- FECHA -->
      <div class="form-group">
        <label><i class="fas fa-calendar-alt icono azul"></i> Fecha</label>
        <input type="date" [(ngModel)]="fecha" name="fecha" required (change)="cargarHorasOcupadas()">
      </div>

      <!-- HORA -->
      <div class="form-group">
        <label><i class="fas fa-clock icono rojo"></i> Hora (1.5 h)</label>
        <select [(ngModel)]="hora" name="hora" [disabled]="cargando">
          <option value="">Seleccione una hora</option>
          <option *ngFor="let h of horasDisponibles" 
                  [value]="h" 
                  [disabled]="esHoraDeshabilitada(h)"
                  [ngClass]="getClaseHora(h)">
            {{ h }}
          </option>
        </select>
        <small *ngIf="cargando" class="cargando-horas">
          <i class="fas fa-spinner fa-spin"></i> Cargando disponibilidad...
        </small>
      </div>

      <div class="botones-formulario">
        <button type="button" class="btn-aceptar" (click)="aceptarReservacion()" [disabled]="cargando">
          <i class="fas fa-check-circle"></i> 
          {{ cargando ? 'Cargando...' : 'Aceptar' }}
        </button>
      </div>
    </form>
  </div>

  <!-- RESUMEN DE RESERVACIÓN -->
  <div *ngIf="resumen && !reservacionConfirmada" class="resumen-reservacion">
    <div class="resumen-contenido">
      <h2 class="titulo-form">
        <i class="fas fa-file-alt"></i>
        Datos de Reservación Docente
      </h2>
      
      <div class="resumen-header">
        <div class="logo-placeholder">
          <i class="fas fa-university"></i>
        </div>
        <div class="fecha-hora-emision">
          <span>Fecha emisión: {{ fechaEmision }}</span>
          <span>Hora emisión: {{ horaEmision }}</span>
        </div>
      </div>

      <!-- TODOS LOS DATOS EN UN SOLO CONTAINER -->
      <div class="datos-container">
        <div class="resumen-item" *ngFor="let item of resumenItems">
          <span class="resumen-label">
            <i [class]="item.icon"></i> {{item.label}}:
          </span>
          <span class="resumen-value">{{item.value}}</span>
        </div>
      </div>

      <div class="separador"></div>

      <div class="botones-resumen">
        <button class="btn-confirmar" (click)="confirmarReservacion()" [disabled]="confirmando">
          <i class="fas fa-check-double"></i> 
          {{ confirmando ? 'Confirmando...' : 'Confirmar' }}
        </button>
        <button class="btn-actualizar" (click)="actualizarReservacion()" [disabled]="confirmando">
          <i class="fas fa-edit"></i> Actualizar
        </button>
        <button class="btn-cancelar" (click)="cancelarReservacion()" [disabled]="confirmando">
          <i class="fas fa-times"></i> Cancelar
        </button>
      </div>

      <!-- Estado de carga durante confirmación -->
      <div *ngIf="confirmando" class="estado-carga">
        <div class="spinner"></div>
        <p>Procesando tu reservación...</p>
      </div>
    </div>
  </div> 
</div>