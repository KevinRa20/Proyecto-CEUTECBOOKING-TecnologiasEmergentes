<div class="contenedor-formulario">
  <!-- Título dinámico -->
  <h2 class="titulo-form" [ngStyle]="resumen ? {'color': '#fff'} : {'color': '#004aad'}">
    {{ resumen ? 'Datos de la Reservación' : 'Reservación de Aula' }}
  </h2>

  <!-- FORMULARIO -->
  <form *ngIf="!resumen" class="form-grid">
  <!-- PANTALLA DE CONFIRMACIÓN EXITOSA -->
  <div *ngIf="reservacionConfirmada" class="confirmacion-exitosa">
    <div class="icono-exito">
      <i class="fas fa-check-circle"></i>
  <h2 class="titulo-form">Reserva Tu Aula</h2>

  <form *ngIf="!resumen" class="form-grid">

    <!-- Fila 1: Nombre completo y Número de cuenta -->
    <div class="form-group">
      <label><i class="fas fa-user icono azul"></i> Nombre completo</label>
      <input type="text" [(ngModel)]="nombre" name="nombre" placeholder="Ingrese su nombre completo" required>
    </div>

    <div class="form-group">
      <label><i class="fas fa-id-card icono rojo"></i> Número de cuenta</label>
      <input type="text" [(ngModel)]="numeroCuenta" name="numeroCuenta" placeholder="Número de cuenta" required>
    </div>

    <div class="form-group">
      <label><i class="fas fa-envelope icono azul"></i> Correo educativo</label>
      <input type="email" [(ngModel)]="correo" name="correo" placeholder="ejemplo@unitec.edu" required>
    </div>

    <div class="form-group">
      <label><i class="fas fa-users icono beige"></i> Otros estudiantes</label>
      <div class="agregar-container">
        <input #nuevoEst type="text" placeholder="Nombre del estudiante" class="input-estudiante">
        <button type="button" class="btn-aceptar" (click)="agregarEstudiante(nuevoEst.value); nuevoEst.value=''">
          <i class="fas fa-plus"></i> Agregar
        </button>
      </div>
      <ul class="lista-estudiantes">
        <li *ngFor="let est of otrosEstudiantes">{{ est }}</li>
      </ul>
    </div>

    <div class="form-group">
      <label><i class="fas fa-university icono azul"></i> Campus</label>
      <select [(ngModel)]="campus" name="campus" (change)="cargarHorasOcupadas()">
        <option value="">Seleccione un campus</option>
        <option *ngFor="let c of campusOpciones" [value]="c">{{ c }}</option>
      </select>
    </div>

    <div class="form-group">
      <label><i class="fas fa-map-marker-alt icono rojo"></i> Sede</label>
      <input type="text" [(ngModel)]="sede" name="sede" placeholder="Sede de la reservación" (change)="cargarHorasOcupadas()">
    </div>

    <div class="form-group">
      <label><i class="fas fa-chalkboard icono beige"></i> Tipo de aula</label>
      <select [(ngModel)]="tipoAula" name="tipoAula" (change)="cargarHorasOcupadas()">
        <option value="">Seleccione tipo de aula</option>
        <option value="Salón de estudio">Salón de estudio</option>
        <option value="Laboratorio">Laboratorio</option>
        <option value="Aula para eventos">Aula para eventos</option>
        <option value="Aula normal">Aula normal</option>
      </select>
    </div>

    <div class="form-group">
      <label><i class="fas fa-door-open icono beige"></i> Número de Aula</label>
      <input type="text" [(ngModel)]="numeroaula" name="numeroaula" placeholder="Número de Aula" required (change)="cargarHorasOcupadas()">
    </div>

    <div class="form-group">
      <label><i class="fas fa-calendar-alt icono azul"></i> Fecha</label>
      <input type="date" [(ngModel)]="fecha" name="fecha" required (change)="cargarHorasOcupadas()">
    </div>

    <div class="form-group">
      <label><i class="fas fa-clock icono rojo"></i> Hora</label>
      <select [(ngModel)]="hora" name="hora">
        <option value="">Seleccione una hora</option>
        <option *ngFor="let h of horasDisponibles" [value]="h"
          [disabled]="horasOcupadas.includes(h)"
          [ngStyle]="{'color': horasOcupadas.includes(h) ? 'red' : '#000', 'text-decoration': horasOcupadas.includes(h) ? 'line-through' : 'none'}">
          {{ h }}
        </option>
      </select>
    </div>

    <div class="botones-formulario">
      <button type="button" class="btn-aceptar" (click)="aceptarReservacion()">
        <i class="fas fa-check-circle"></i> Aceptar
      </button>
    </div>
  </form>

  <!-- RESUMEN -->
  <div *ngIf="resumen" class="resumen-reservacion">
    <div class="info-resumen">
      <div class="resumen-item"><span class="resumen-label">Nombre:</span> {{ resumen.nombre }}</div>
      <div class="resumen-item"><span class="resumen-label">Cuenta:</span> {{ resumen.numeroCuenta }}</div>
      <div class="resumen-item"><span class="resumen-label">Correo:</span> {{ resumen.correo }}</div>
      <div class="resumen-item"><span class="resumen-label">Otros estudiantes:</span> {{ resumen.otrosEstudiantes.join(', ') || 'Ninguno' }}</div>
      <div class="resumen-item"><span class="resumen-label">Campus:</span> {{ resumen.campus }}</div>
      <div class="resumen-item"><span class="resumen-label">Sede:</span> {{ resumen.sede }}</div>
      <div class="resumen-item"><span class="resumen-label">Tipo de aula:</span> {{ resumen.tipoAula }}</div>
      <div class="resumen-item"><span class="resumen-label">Aula:</span> {{ resumen.numeroaula }}</div>
      <div class="resumen-item"><span class="resumen-label">Fecha:</span> {{ resumen.fecha }}</div>
      <div class="resumen-item"><span class="resumen-label">Hora:</span> {{ resumen.hora }}</div>
    </div>

    <div class="botones-resumen">
      <button class="btn-confirmar" (click)="confirmarReservacion()"><i class="fas fa-check"></i> Confirmar</button>
      <button class="btn-actualizar" (click)="actualizarReservacion()"><i class="fas fa-edit"></i> Actualizar</button>
      <button class="btn-cancelar" (click)="cancelarReservacion()"><i class="fas fa-times"></i> Cancelar</button>
    </div>

    <div *ngIf="qrDataUrl" class="qr-container">
      <h4>Código QR de tu reservación</h4>
      <img [src]="qrDataUrl" alt="Código QR">
    </div>
  </div>
</div>
    <h2 class="titulo-confirmacion">¡Reservación Confirmada!</h2>
    <p class="mensaje-confirmacion">Tu reserva se ha completado satisfactoriamente</p>
    
    <div class="imagen-check">
      <i class="fas fa-check-double"></i>
    </div>
    
    <!-- CONTENEDOR DEL QR SIMPLIFICADO -->
    <div class="qr-container-simple" *ngIf="qrGenerado">
      <!-- Estado de carga -->
      <div *ngIf="generandoQR && !qrCargado" class="qr-cargando">
        <div class="spinner"></div>
        <p>Generando código QR...</p>
      </div>

      <!-- QR Generado Simple -->
      <div *ngIf="!generandoQR && qrDataUrl" class="qr-simple">
        <img [src]="qrDataUrl" 
             alt="Código QR de reservación" 
             class="qr-image-simple"
             (load)="onQRLoaded()"
             (error)="onQRError()">
      </div>

      <!-- Botón para regenerar -->
      <button class="btn-regenerar-qr" (click)="regenerarQR()" *ngIf="errorQR || !qrCargado">
        <i class="fas fa-sync-alt"></i> Reintentar QR
      </button>
    </div>
  </div>

  <!-- FORMULARIO PRINCIPAL -->
  <div *ngIf="!resumen && !reservacionConfirmada">
    <h2 class="titulo-form">
      <i class="fas fa-calendar-check"></i>
      Formulario de Reservación
    </h2>

    <form class="form-grid">
      <div class="form-group">
        <label><i class="fas fa-user icono azul"></i> Nombre completo</label>
        <input type="text" [(ngModel)]="nombre" name="nombre" placeholder="Ingrese su nombre completo" required>
      </div>

      <div class="form-group">
        <label><i class="fas fa-id-card icono rojo"></i> Número de cuenta</label>
        <input type="text" [(ngModel)]="numeroCuenta" name="numeroCuenta" placeholder="Número de cuenta" required>
      </div>

      <div class="form-group">
        <label><i class="fas fa-envelope icono azul"></i> Correo educativo</label>
        <input type="email" [(ngModel)]="correo" name="correo" placeholder="ejemplo@dominio.edu" required>
      </div>

      <div class="form-group">
        <label><i class="fas fa-users icono beige"></i> Otros estudiantes</label>
        <div class="agregar-container">
          <input #nuevoEst type="text" placeholder="Nombre del estudiante" class="input-estudiante">
          <button type="button" class="btn-agregar" (click)="agregarEstudiante(nuevoEst.value); nuevoEst.value=''">
            <i class="fas fa-plus"></i>
          </button>
        </div>
        <ul class="lista-estudiantes">
          <li *ngFor="let est of otrosEstudiantes; let i = index" class="estudiante-item">
            <span>{{ est }}</span>
            <button type="button" class="btn-eliminar" (click)="eliminarEstudiante(i)">
              <i class="fas fa-times"></i>
            </button>
          </li>
        </ul>
      </div>

      <div class="form-group">
        <label><i class="fas fa-university icono azul"></i> Campus</label>
        <select [(ngModel)]="campus" name="campus" (change)="cargarHorasOcupadas()">
          <option value="">Seleccione un campus</option>
          <option *ngFor="let c of campusOpciones" [value]="c">{{ c }}</option>
        </select>
      </div>

      <div class="form-group">
        <label><i class="fas fa-map-marker-alt icono rojo"></i> Sede</label>
        <input type="text" [(ngModel)]="sede" name="sede" placeholder="Sede de la reservación">
      </div>

      <div class="form-group">
        <label><i class="fas fa-chalkboard icono beige"></i> Tipo de aula</label>
        <select [(ngModel)]="tipoAula" name="tipoAula" (change)="cargarHorasOcupadas()">
          <option value="">Seleccione tipo de aula</option>
          <option value="Salón de estudio">Salón de estudio</option>
          <option value="Laboratorio">Laboratorio</option>
          <option value="Aula para eventos">Aula para eventos</option>
          <option value="Aula normal">Aula normal</option>
        </select>
      </div>

      <div class="form-group">
        <label><i class="fas fa-door-open icono beige"></i> Número de Aula</label>
        <input type="text" [(ngModel)]="numeroaula" name="numeroaula" placeholder="Número de Aula" 
               (change)="cargarHorasOcupadas()" required>
      </div>

      <div class="form-group">
        <label><i class="fas fa-calendar-alt icono azul"></i> Fecha</label>
        <input type="date" [(ngModel)]="fecha" name="fecha" required (change)="cargarHorasOcupadas()">
      </div>

      <div class="form-group">
        <label><i class="fas fa-clock icono rojo"></i> Hora (1.5 h)</label>
        <select [(ngModel)]="hora" name="hora" [disabled]="cargando">
          <option value="">Seleccione una hora</option>
          <option *ngFor="let h of horasDisponibles" 
                  [value]="h" 
                  [disabled]="esHoraDeshabilitada(h)"
                  [ngClass]="getClaseHora(h)">
            {{ h }}
          </option>
        </select>
        <small *ngIf="cargando" class="cargando-horas">
          <i class="fas fa-spinner fa-spin"></i> Cargando disponibilidad...
        </small>
      </div>

      <div class="botones-formulario">
        <button type="button" class="btn-aceptar" (click)="aceptarReservacion()" [disabled]="cargando">
          <i class="fas fa-check-circle"></i> 
          {{ cargando ? 'Cargando...' : 'Aceptar' }}
        </button>
      </div>
    </form>
  </div>

  <!-- RESUMEN DE RESERVACIÓN - TODOS LOS DATOS EN UN MISMO CONTAINER -->
  <div *ngIf="resumen && !reservacionConfirmada" class="resumen-reservacion">
    <div class="resumen-contenido">
      <h2 class="titulo-form">
        <i class="fas fa-file-alt"></i>
        Datos de Reservación
      </h2>
      
      <div class="resumen-header">
        <div class="logo-placeholder">
          <i class="fas fa-university"></i>
        </div>
        <div class="fecha-hora-emision">
          <span>Fecha emisión: {{ fechaEmision }}</span>
          <span>Hora emisión: {{ horaEmision }}</span>
        </div>
      </div>

      <!-- TODOS LOS DATOS EN UN SOLO CONTAINER -->
      <div class="datos-container">
        <div class="resumen-item" *ngFor="let item of resumenItems">
          <span class="resumen-label">
            <i [class]="item.icon + ' icono'"></i> {{item.label}}:
          </span>
          <span class="resumen-value">{{item.value}}</span>
        </div>
      </div>

      <div class="separador"></div>

      <div class="botones-resumen">
        <button class="btn-confirmar" (click)="confirmarReservacion()" [disabled]="confirmando">
          <i class="fas fa-check-double"></i> 
          {{ confirmando ? 'Confirmando...' : 'Confirmar' }}
        </button>
        <button class="btn-actualizar" (click)="actualizarReservacion()" [disabled]="confirmando">
          <i class="fas fa-edit"></i> Actualizar
        </button>
        <button class="btn-cancelar" (click)="cancelarReservacion()" [disabled]="confirmando">
          <i class="fas fa-times"></i> Cancelar
        </button>
      </div>

      <!-- Estado de carga durante confirmación -->
      <div *ngIf="confirmando" class="estado-carga">
        <div class="spinner"></div>
        <p>Procesando tu reservación...</p>
      </div>
    </div>
  </div> 
</div>
